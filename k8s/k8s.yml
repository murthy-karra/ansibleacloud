---
- hosts: all
  become: true
  tasks:
    - name: Update and upgrade apt packages
      become: true
      apt:
        upgrade: yes
        update_cache: yes
        cache_valid_time: 3600

    # - name: Install ntp
    #   apt:
    #     name: ntp
    #     state: latest
    #     update_cache: true
    # - name: Create CRI-O config file
    #   file:
    #     path: "/etc/modules-load.d/crio.conf"
    #     state: "touch"

    # - name: add modules in conf file
    #   blockinfile:
    #     path: "/etc/modules-load.d/crio.conf"
    #     block: |
    #         overlay
    #         br_netfilter

    # - name: Enable sysctl params
    #   file:
    #     path: "/etc/sysctl.d/99-kubernetes-cri.conf"
    #     state: "touch"

    # - name: add configuration
    #   blockinfile:
    #     path: "/etc/sysctl.d/99-kubernetes-cri.conf"
    #     block: |
    #             net.bridge.bridge-nf-call-iptables = 1
    #             net.ipv4.ip_forward = 1
    #             net.bridge.bridge-nf-call-ip6tables = 1

    # - name: enable overlayFS & VxLan pod communication
    #   shell: |
    #           sudo modprobe overlay
    #           sudo modprobe br_netfilter
    # - name: Reload parameters
    #   command: sudo sysctl --system

    # - name: disable swap
    #   shell: |
    #           sudo swapoff -a
    #           sudo sed -i '/ swap / s/^\(.*\)$/#\1/g' /etc/fstab

    # - name: enable cri-repo
    #   environment:
    #     OS: xUbuntu_22.04
    #     VERSION: 1.26
    #   shell: |
    #             echo "deb https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/$OS/ /" > /etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list
    #             echo "deb http://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable:/cri-o:/$VERSION/$OS/ /" > /etc/apt/sources.list.d/devel:kubic:libcontainers:stable:cri-o:$VERSION.list

    #             curl -L https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable:cri-o:$VERSION/$OS/Release.key | apt-key add -
    #             curl -L https://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/$OS/Release.key | apt-key add -
    #   tags: current

    # - name: Install cri-o and cri-o tools
    #   shell: |
    #           sudo apt update
    #           sudo apt install cri-o cri-o-runc cri-tools -y
    #           sudo systemctl daemon-reload
    #           sudo systemctl enable crio --now
    #   tags: current

    # - name: Install dependencies
    #   shell: |
    #           sudo apt update
    #           sudo apt install -y apt-transport-https curl
    #           curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
    #   tags: current

    # - name: Create kubernetes repo file
    #   file:
    #     path: "/etc/apt/sources.list.d/kubernetes.list"
    #     state: "touch"
    #   tags: current

    # - name: Add K8s Source
    #   blockinfile:
    #     path: "/etc/apt/sources.list.d/kubernetes.list"
    #     block: |
    #           deb https://apt.kubernetes.io/ kubernetes-xenial main
    #   tags: current

    # - name: install kubernetes
    #   shell: |
    #           sudo apt-get update
    #           sudo apt-get install -y kubelet=1.26.4-00 kubeadm=1.26.4-00 kubectl=1.26.4-00
    #           sudo apt-mark hold kubelet kubeadm kubectl
    #   tags: current
